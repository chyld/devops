# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #

# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/home/chyld/.bin/miniconda/bin/conda' 'shell.bash' 'hook' 2> /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "/home/chyld/.bin/miniconda/etc/profile.d/conda.sh" ]; then
        . "/home/chyld/.bin/miniconda/etc/profile.d/conda.sh"
    else
        export PATH="/home/chyld/.bin/miniconda/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<

# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #

BIN_PATH=$HOME/.bin
BTOP_PATH=$HOME/.bin/btop/bin
NVIM_PATH=$HOME/.bin/nvim/bin
NODE_PATH=$HOME/.bin/node/bin
SCRIPTS_PATH=$HOME/Code/devops/scripts
export PATH=$BIN_PATH:$BTOP_PATH:$NVIM_PATH:$NODE_PATH:$SCRIPTS_PATH:$PATH
export FZF_DEFAULT_COMMAND='fd --type file --type symlink --unrestricted --exclude .git --exclude node_modules'

# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #

alias eb="vi ~/.bash_custom" # edit bash
alias sb="source ~/.bash_custom" # source bash
alias dev="cd ~/Code/devops" # devops
alias dots="cd ~/Code/devops/platforms/mint-ubuntu/v014" # dot files
alias nv="cd ~/.config/nvim" # neovim
alias bin="cd ~/.bin"
alias dl="cd ~/Downloads"
alias c="clear"
alias b="cd .." # go back
alias t="tree -a -I .git"
alias vi="nvim"
alias vim="nvim"
alias cat="bat"
alias g="git"
alias gs="git status"
alias gd="git diff"
alias jl="jupyter lab"
alias l="lsd -a --group-directories-first" # "exa --icons --git -a"
alias ll="exa --icons --git -al --group-directories-first"
alias cl="c;l"
alias cll="c;ll"
alias pbcopy="wl-copy"
alias pbpaste="wl-paste"
alias rg="rg --hidden --ignore-case --glob '!node_modules' --glob '!.git'"

# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #

# NOTE ABOUT MIXING LANGUAGES
#
# if you want to embed a langugae like python, js or lua in a bash function,
# then you should prefix your code with tabs, \t. when this runs, due
# to the "<<-EOF", bash will strip out all the tabs BEFORE it sends it
# to the language server. this keeps the code here nice looking.
# You can still add spaces to your code, but only after your baseline tabs.
#
# all processes have to read from files, but the inline code does not have a filename,
# so it is read in via stdin, which is a pseudo-file, the "python -", means read the file
# on stdin.
#
# i setup a keybinding in vscode to manually insert tabs (control, option, command, t)
# in nvim, "control + v, then tab" will force a tab insert

vis() {
    # vi(s)earch
    # fuzzy search files with preview and then load into neovim
    vi $(fzf --layout=reverse --preview='bat -n --color=always {}')
}

view_env_variables_by_process_id() {
    pid=$1
    cat /proc/"$pid"/environ | tr '\0' '\n' > env.txt

    $(python - <<-EOF
		with open("env.txt", "r") as file:
		    lines = file.readlines() # leave the final spaces, do not strip out
		modified_lines = [line.replace("=", ",", 1) for line in lines]
		with open("env.csv", "w") as file:
		    file.writelines(modified_lines) # leave the final spaces, do not strip out
		EOF
    )

    cat env.csv
}

sd() {
    # synd dot files to github
    current_dir=$(pwd)
    cd ~/Code/devops
    git status
    git add .
    git commit -am "auto sync"
    git push
    cd "$current_dir"
}

path() {
    path_multi_line=$(python - "$PATH" <<-EOF # passing $PATH in, not needed
		import sys                            # not needed, using bash variable expansion
		get_path_from_bash = "$PATH"          # sys.argv[1] not needed, $PATH is expanded by bash before script is run
		post_processed = '\n'.join(get_path_from_bash.split(':'))
		print(post_processed)
		EOF
    )
    echo "$path_multi_line" | nl
}

x() {
    cd ~/Xplore
}

xl() {
    # x-list
    cd ~/Xplore
    lsd --tree --depth 2 -ar --sort time --group-directories-first # exa -Ta --level 2 --icons --sort created
}

xs() {
    # x-save
    curr=$(pwd)
    dest=$(echo $curr | sed 's|/Temp/|/Save/|')
    gum confirm "$curr to $dest?"   && cd ~/Xplore                \
                                    && mv "$curr" "$dest"         \
                                    cd "$dest"                    \
                                    echo "dir moved to: $(pwd)"
}

xc() {
    # x-create
    destination=$(xplore.py)   # destination reads stdout from xplore.py
    retval=$?                  # capture the return value before it changes
    if [ $retval -eq 3 ]; then # should be 3
        cd $destination
        gum style \
            --foreground "#ff33cc" --border-foreground "#ccff33" --border normal \
            --align center --width 30 --margin "1 2" --padding "1 2" \
            'Xplore Project Creator'
        # https://www.nerdfonts.com/cheat-sheet
        template=$(gum choose "󰅬  blank" "󰈸  physics" "󰺵  p5js" "  python" "  javascript" "  typescript" "  lua")
        touch README.md
        case "$template" in
            *blank)
                # nothing here
                ;;
            *physics)
                cp $HOME/Code/devops/templates/physics/physics.ipynb .
                ;;
            *p5js)
                cp $HOME/Code/devops/templates/p5js/* .
                ;;
            *python)
                fake_names 3 py
                ;;
            *javascript)
                echo "node_modules" > .gitignore
                npm init -y
                fake_names 3 js
                ;;
            *typescript)
                echo "node_modules" > .gitignore
                npm init -y
                npm install typescript --save-dev
                npx tsc --init
                fake_names 3 ts
                ;;
            *lua)
                fake_names 3 lua
                ;;
        esac
        git init
        git add .
        git commit -m "Commit Zero"
        git log
        ll
    fi
}

fake_names() {
    count=$1
    extension=$2
    names=$(faker -r=$count last_name_female)
    for name in $names; do
        no_space="${name// /}"           # Remove all spaces
        no_upper="${no_space,,}"         # Convert to lowercase
        touch "${no_upper}"."${extension}"
    done
}

# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #

conda activate prometheus

eval "$(starship init bash)"

source ~/.fzf.bash

# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #
# ---------------------------------------------------------------------- #

